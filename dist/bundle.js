!function(t){var i={};function e(o){if(i[o])return i[o].exports;var s=i[o]={i:o,l:!1,exports:{}};return t[o].call(s.exports,s,s.exports,e),s.l=!0,s.exports}e.m=t,e.c=i,e.d=function(t,i,o){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:o})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(e.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var s in t)e.d(o,s,function(i){return t[i]}.bind(null,s));return o},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=1)}([function(t,i){window.GLOBALS={blobs:[],windowSize:{horizontal:0,vertical:0},keyState:{left:!1,right:!1,down:!1,up:!1},gameState:{gravity:!1,repulsion:!1,drag:!0,borderBounce:!0,borderTeleport:!1},player:null,pairwiseForceStrength:1,viewDistance:200,initialSize:14,initialPos:[50,50],speedUp:.5,diagonal:1/Math.sqrt(2),maxPop:10,drag:.004,appetite:5e-4,G:.5,R:-.5,minSize:10,borderElasticity:.005,fps:50,globalOpacity:1,opacityIncrement:.005,faderInterval:null}},function(t,i,e){"use strict";e.r(i);e(0);const o=5;let s=[],r=0;for(let t=0;t<o;t++)s.push(new Audio("sounds/bubble_pop.mp3"));function n(){return document.getElementById("game-display")}let{windowSize:a,keyState:c,gameState:h,pairwiseForceStrength:l,speedUp:p,diagonal:d,drag:u,appetite:y,G:v,R:g,minSize:b,borderElasticity:f,globalOpacity:w}=window.GLOBALS;class m{constructor(t,i,e=[0,0],o=!1,s=[0,0]){this.radius=t,this.mass=Math.pow(t,3),this.position=i,this.velocity=e,this.force=[0,0],this.isPlayer=o,this.pairwiseForce=s,this.moving=!1,this.blobDiv=document.createElement("div"),this.blobDiv.classList.add("blob"),n().appendChild(this.blobDiv),o&&(this.blobDiv.id="player")}updateMovement(){this.move(),h.drag&&this.viscosity(),this.accelerate(),h.borderTeleport&&this.teleport(),h.borderBounce&&this.borderBounce(),this.updateDiv(),this.pairwiseForce=[0,0]}updatePlayerForce(){c.up?c.left?this.force=[-d,d]:c.right?this.force=[d,d]:this.force=[0,1]:c.down?c.left?this.force=[-d,-d]:c.right?this.force=[d,-d]:this.force=[0,-1]:c.right?this.force=[1,0]:c.left?this.force=[-1,0]:this.force=[0,0]}blobWander(){this.moving&&Math.random()>.95&&this.newRandomDirection(),Math.random()>.993&&this.toggleMoving()}newRandomDirection(){let t=2*Math.random()*Math.PI,i=Math.random();this.force[0]=Math.cos(t)*i,this.force[1]=Math.sin(t)*i}toggleMoving(){this.moving=!this.moving}getAbsVel(){return Math.sqrt(Math.pow(this.velocity[0],2)+Math.pow(this.velocity[1],2))}updateDiv(){this.blobDiv.style.left=this.position[0]-this.radius+"px",this.blobDiv.style.bottom=this.position[1]-this.radius+"px",this.blobDiv.style.height=2*this.radius+"px",this.blobDiv.style.width=2*this.radius+"px"}move(){this.position[0]+=this.velocity[0],this.position[1]+=this.velocity[1]}viscosity(){this.velocity[0]*=1-u*Math.sqrt(this.radius)*Math.abs(this.velocity[0]),this.velocity[1]*=1-u*Math.sqrt(this.radius)*Math.abs(this.velocity[1])}hunger(){this.radius>b&&(this.radius*=1-y)}getRadius(){return this.radius}getMass(){return this.mass}getVel(){return this.velocity}getPos(){return this.position}getForce(){return this.force}setForce(t){this.force=t}adjustVelocityBy(t){this.velocity[0]+=t[0],this.velocity[1]+=t[1]}adjustPositionBy(t){this.position[0]+=t[0],this.position[1]+=t[1]}accelerate(){h.drag&&(this.velocity[0]+=p*this.force[0],this.velocity[1]+=p*this.force[1]),(h.gravity||h.repulsion)&&(this.velocity[0]+=this.pairwiseForce[0]/this.mass,this.velocity[1]+=this.pairwiseForce[1]/this.mass)}borderBounce(){this.position[0]<-this.radius?this.velocity[0]-=f*(this.position[0]+this.radius):this.position[0]>this.radius+a.horizontal&&(this.velocity[0]-=f*(this.position[0]-this.radius-a.horizontal)),this.position[1]<-this.radius?this.velocity[1]-=f*(this.position[1]+this.radius):this.position[1]>this.radius+a.vertical&&(this.velocity[1]-=f*(this.position[1]-this.radius-a.vertical))}teleport(){this.position[0]=(this.position[0]+a.horizontal)%a.horizontal,this.position[1]=(this.position[1]+a.vertical)%a.vertical}deleteDiv(){this.blobDiv.parentNode.removeChild(this.blobDiv)}biggerThan(t){return this.radius>=t.radius}consume(t,i=!1){const e=Math.pow(t.radius,3)/(Math.pow(this.radius,3)+Math.pow(t.radius,3));let n=[this.position[0]+(t.position[0]-this.position[0])*e,this.position[1]+(t.position[1]-this.position[1])*e],a=[this.velocity[0]+(t.velocity[0]-this.velocity[0])*e,this.velocity[1]+(t.velocity[1]-this.velocity[1])*e],c=Math.pow(Math.pow(this.radius,3)+Math.pow(t.radius,3),1/3);t.deleteDiv();const h=this.getOpacity();this.deleteDiv(),s[r=(r+1)%o].play();const l=new m(c,n,a,i);return l.setOpacity(h),l}setOpacity(t){this.blobDiv.style.opacity=t}getOpacity(){return this.blobDiv.style.opacity}static getDistance(t,i,e){const o=Math.sqrt(Math.pow(t.position[0]-i.position[0],2)+Math.pow(t.position[1]-i.position[1],2));return e?o:o-(t.radius+i.radius)}static pairwiseInteraction(t,i){if(h.gravity||h.repulsion){const e=m.getDistance(t,i,!0);let o=l*t.mass*i.mass/Math.pow(e,2);const s=(o*=h.gravity?v:g)*(t.position[0]-i.position[0])/e,r=o*(t.position[1]-i.position[1])/e;t.pairwiseForce[0]-=s,t.pairwiseForce[1]-=r,i.pairwiseForce[0]+=s,i.pairwiseForce[1]+=r}}}var M=37,k=38,S=39,D=40,O=71,z=82,P=84,F=90,B=86,I=65,x=32;const L=(t,i)=>t.map((t,e)=>t+i[e]),j=(t,i)=>t.map((t,e)=>t-i[e]),E=(t,i)=>i.map(i=>i*t);let{blobs:T,windowSize:_,keyState:C,gameState:R,player:q,viewDistance:A,initialSize:G,initialPos:V,maxPop:W,fps:U,opacityIncrement:N,globalOpacity:H,faderInterval:J}=window.GLOBALS;function K(t){clearInterval(J),J=setInterval(function(){const i=Math.sign(t-H);H+=i*N,T.forEach(t=>{t.setOpacity(i?Math.max(H,t.getOpacity()):Math.min(H,t.getOpacity()))}),H==t&&clearInterval(J)},1e3/U)}function Q(){document.getElementById("instructions").classList.toggle("hidden")}function X(){q=null,Q(),K(1)}function Y(t=.8*G*Math.pow(5,Math.pow(Math.random(),2)),i=function(){const t=4*Math.random();return t<1?entryPoint=[0,_.vertical*t]:t<2?[_.horizontal*(t-1),0]:t<3?[_.horizontal,_.vertical*(t-2)]:[_.horizontal*(t-3),0]}(),e=[4*Math.random()-2,4*Math.random()-2]){let o=new m(t,i,e,!1);T.push(o)}function Z(t){return Math.max(1-t/A,H)}window.iteration=function(){T.length<W&&Math.random()>.99&&Y(),q&&(q.updateMovement(),A=10*G+5*q.radius);let t=[];for(let i=0;i<T.length;i++)if(T[i]){if(T[i].blobWander(),T[i].updateMovement(),q){let t=m.getDistance(T[i],q,!1);if(t<0){if(q.biggerThan(T[i])){const t=q.getForce();(q=q.consume(T[i],!0)).setForce(t),T[i]=null;continue}T[i]=T[i].consume(q),T[i].setOpacity(1),X()}else T[i].setOpacity(Z(t)),m.pairwiseInteraction(q,T[i])}for(let t=i+1;t<T.length;t++)T[t]&&(m.getDistance(T[i],T[t],!1)<0?(T[i]=T[i].biggerThan(T[t])?T[i].consume(T[t]):T[t].consume(T[i]),T[t]=null):m.pairwiseInteraction(T[i],T[t]));t.push(T[i])}T=t},window.updateWindowSize=function(){let t=n().getBoundingClientRect();_.horizontal=t.width,_.vertical=t.height,V=[_.horizontal/2,_.vertical/2]},window.keyDown=function(t){switch(t.keyCode){case k:C.up=!0;break;case D:C.down=!0;break;case M:C.left=!0;break;case S:C.right=!0;break;case O:R.gravity=!0,R.repulsion=!1;break;case z:R.gravity=!1,R.repulsion=!0}q&&q.updatePlayerForce()},window.keyUp=function(t){switch(t.keyCode){case S:C.right=!1;break;case M:C.left=!1;break;case k:C.up=!1;break;case D:C.down=!1;break;case O:R.gravity=!1,pairwiseForceStrength=0;break;case z:R.repulsion=!1,pairwiseForceStrength=0;break;case B:R.drag=!R.drag;break;case P:R.borderTeleport=!R.borderTeleport,R.borderBounce=!R.borderTeleport;break;case F:!function(){let t=[0,0],i=[0,0],e=0,o=q?T.concat([q]):T;for(let s=0;s<o.length;s++){let r=o[s].getMass(),n=o[s].getVel(),a=o[s].getPos();e+=r,t=L(t,E(r,n)),i=L(i,E(r,a))}let s=E(-1/e,t),r=j(V,E(1/e,i));for(let t=0;t<o.length;t++)o[t].adjustVelocityBy(s),o[t].adjustPositionBy(r)}();break;case I:Y()}q&&q.updatePlayerForce()},window.keyPress=function(t){switch(t.keyCode){case x:q||(q=new m(G,[...V],[0,0],!0),Q(),clearInterval(J),K(0))}},window.onload=function(){updateWindowSize(),document.addEventListener("keydown",keyDown,!1),document.addEventListener("keyup",keyUp,!1),document.addEventListener("keypress",keyPress,!1),window.addEventListener("resize",updateWindowSize,!1),Q(),setInterval(iteration,1e3/U)}}]);
//# sourceMappingURL=bundle.js.map